name: Python CI  # GitHub Actions 탭에 보이는 이름

on:              # 언제 이 워크플로우를 실행할지 정의
  push:          # 1) main 브랜치에 push 할 때
    branches: [ "main" ]
  pull_request:  # 2) main 기준으로 PR 보낼 때
    branches: [ "main" ]

jobs:            # 실제로 실행될 작업(Job) 목록
  build:
    runs-on: ubuntu-latest   # 이 Job은 Ubuntu 리눅스 머신에서 실행

    steps:                   # Job 안에서 순서대로 실행되는 단계들
    - name: Checkout repository
      uses: actions/checkout@v4
      # -> GitHub repo의 코드를 runner(가상머신)에 내려받는 step

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.11"
      # -> Python 3.11 설치

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install poetry
        poetry install
      # -> pip 업데이트 / poetry 설치 / pyproject.toml 기준 의존성 설치

    - name: Run tests
      run: |
        poetry run pytest -v
      # -> pytest 실행 (테스트 실패 시 이 step에서 워크플로우 전체가 실패로 표시)
